<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BloomWatch üå∏ by Snorita Asrafee</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<style>
body{margin:0;font-family:'Poppins',sans-serif;background:url('https://eoimages.gsfc.nasa.gov/images/imagerecords/145000/145474/world.topo.bathy.200412.3x5400x2700.jpg') center/cover no-repeat;color:#fff;overflow-x:hidden;}
header{position:fixed;top:0;left:0;width:100%;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.6);padding:10px 20px;z-index:1000;backdrop-filter: blur(5px);}
header h1{margin:0;font-size:22px;color:#2ecc71;text-shadow:1px 1px 3px #000;}
header nav a{color:#fff;margin-left:15px;text-decoration:none;font-weight:600;transition:0.3s;}
header nav a:hover{color:#2ecc71;text-shadow:0 0 5px #2ecc71;}
#hero{margin-top:80px;background: rgba(0,0,0,0.5);backdrop-filter: blur(6px);border-radius:12px;padding:25px;max-width:1200px;margin-left:auto;margin-right:auto;text-align:center;color:#fff;box-shadow:0 0 25px rgba(46,204,113,0.4);}
#hero h2{ font-size:32px;color:#2ecc71;margin-bottom:15px;text-shadow:1px 1px 4px #000; }
#hero .stats{ display:flex; flex-wrap:wrap; justify-content:space-around; font-size:16px; }
#hero .stats div{ margin:10px; background:rgba(46,204,113,0.2); padding:15px 20px; border-radius:10px; min-width:150px; transition:0.3s; position:relative; }
#hero .stats div:hover{ background:rgba(46,204,113,0.5); transform:scale(1.05); box-shadow:0 0 10px #2ecc71; }
.pulse{ position:absolute; top:-5px; right:-5px; width:15px; height:15px; background: #ff4757; border-radius:50%; animation: pulse 1.5s infinite;}
@keyframes pulse{0%{transform:scale(0.8);opacity:1;}50%{transform:scale(1.5);opacity:0.6;}100%{transform:scale(0.8);opacity:1;}}
#controls{padding:20px;text-align:center; margin:20px auto; background:rgba(0,0,0,0.3); border-radius:12px; backdrop-filter:blur(5px); max-width:1200px;}
select,input[type="range"]{margin:10px;padding:8px;border-radius:8px;border:none;font-size:14px;}
button{padding:10px 15px;border-radius:8px;border:none;background:#2ecc71;color:#fff;font-weight:bold;margin:10px; cursor:pointer; transition:0.3s; box-shadow:0 0 10px rgba(46,204,113,0.5);}
button:hover{transform:scale(1.05); background:#27ae60;}
#map{height:60vh;margin:20px auto; max-width:1200px; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.5);}
.charts{display:flex; flex-wrap:wrap; gap:20px; padding:20px; justify-content:center;}
canvas{background:rgba(255,255,255,0.9);border-radius:12px;padding:10px;}
#prediction{background: rgba(255,255,255,0.1); padding:20px; border-radius:12px; margin:20px auto; max-width:1200px; cursor:pointer; backdrop-filter:blur(5px); box-shadow:0 0 20px rgba(46,204,113,0.3);}
.pred-item{display:inline-block;margin:5px;padding:5px 10px;border-radius:8px;background:rgba(46,204,113,0.7); transition:0.3s;}
.pred-item:hover{background:rgba(46,204,113,1); transform:scale(1.05); box-shadow:0 0 10px #2ecc71;}
.floating-flower, .star{position:fixed;width:15px;height:15px; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="pink"><path d="M12 2a2 2 0 0 1 2 2c0 .7-.2 1.4-.6 2a4.5 4.5 0 0 1 6.1 6.1c.6-.4 1.3-.6 2-.6a2 2 0 0 1 0 4c-.7 0-1.4-.2-2-.6a4.5 4.5 0 0 1-6.1 6.1c.4.6.6 1.3.6 2a2 2 0 0 1-4 0c0-.7.2-1.4.6-2a4.5 4.5 0 0 1-6.1-6.1c-.6.4-1.3.6-2 .6a2 2 0 0 1 0-4c.7 0 1.4.2 2 .6a4.5 4.5 0 0 1 6.1-6.1c-.4-.6-.6-1.3-.6-2a2 2 0 0 1 2-2z"/></svg>') no-repeat center/contain; animation:float 12s linear infinite; opacity:0.7; z-index:999; filter:drop-shadow(0 0 3px #2ecc71);}
@keyframes float{from{transform:translateY(100vh) rotate(0deg);}to{transform:translateY(-120vh) rotate(360deg);}}
.star{width:3px;height:3px;background:#fff;border-radius:50%;opacity:0.6; animation:starAnim 20s linear infinite;}
@keyframes starAnim{0%{transform:translateY(100vh);}100%{transform:translateY(-120vh);}}
#loadingOverlay{position:fixed;top:0;left:0;width:100%;height:100%; background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center; z-index:2000;color:#fff;font-size:24px; display:none;}
#loadingOverlay span{border:4px solid #fff;border-top:4px solid #2ecc71;border-radius:50%; width:50px;height:50px;animation:spin 1s linear infinite; display:block;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
footer{text-align:center; padding:15px; background:rgba(0,0,0,0.5); color:#fff; font-size:14px; backdrop-filter:blur(5px);}
footer a{color:#2ecc71; text-decoration:none;}
#sidebar{position:fixed;top:80px;right:0;width:250px;background:rgba(0,0,0,0.6);padding:15px;border-radius:12px 0 0 12px;color:#fff;backdrop-filter:blur(6px);max-height:80vh;overflow-y:auto;box-shadow:0 0 20px rgba(46,204,113,0.5);z-index:1000;}
#sidebar h3{color:#2ecc71;text-align:center;margin:0 0 10px 0;}
#sidebar button{width:100%;margin-top:10px;}
</style>
</head>
<body>
<div id="loadingOverlay"><span></span> Loading data...</div>

<header>
<h1>üå∏ BloomWatch</h1>
<nav>
<a href="#map">Map</a>
<a href="#charts">Charts</a>
<a href="#prediction">Prediction</a>
<a href="#about">About</a>
</nav>
</header>

<div id="sidebar">
<h3>üå± NASA Insights</h3>
<div id="factsText"></div>
<button id="newFact">üîÑ Show Another Fact</button>
</div>

<div id="hero">
<h2>üå∏ BloomWatch Dashboard</h2>
<div class="stats">
<div>Total Observations: <span id="totalObs">0</span></div>
<div>Species Tracked: <span id="speciesCount">0</span></div>
<div>Next Predicted Bloom: <span id="nextBloom">Calculating...</span></div>
<div>Current Hotspot: <span id="hotspot">N/A</span><div class="pulse"></div></div>
</div>
<div id="topSpecies" style="margin-top:15px;">Top Species: <span id="topSpeciesList"></span></div>
</div>

<div id="controls">
<label for="speciesFilter">Filter by species:</label>
<select id="speciesFilter"><option value="All">All Species</option></select><br>
<label for="timeline">Bloom Timeline:</label><br>
<input type="range" id="timeline" min="0" max="100" value="100">
<p id="timeline-date">Showing all dates</p><br>
<label><input type="checkbox" id="ndviFilter"> Show only high NDVI (&gt;0.5)</label><br>
<button id="exportCSV">Export Filtered Data</button>
<button id="playTimeline">‚ñ∂Ô∏è Play Timeline</button>
</div>

<div id="map"></div>

<div class="charts" id="charts">
<canvas id="barChart" width="400" height="200"></canvas>
<canvas id="timelineChart" width="400" height="200"></canvas>
</div>

<div id="prediction">
<h2>üå± Next Bloom Predictions</h2>
<div id="prediction-text">Calculating predictions...</div>
</div>

<section id="about" style="padding:20px;">
<h2>About</h2>
<p>BloomWatch is designed by <strong>Snorita Asrafee</strong> üå∏.  
It uses NASA GLOBE Phenology data and MODIS NDVI to visualize blooms, predict flowering events, and highlight vegetation hotspots with a modern eco-space interface.  
Interactive charts and maps allow you to track flowering trends and hotspots in real-time.</p>
</section>

<footer>
Data from <a href="https://globe.gov/">NASA GLOBE Observer</a> & MODIS NDVI | Designed by <strong>Snorita Asrafee</strong> | <a href="#">GitHub Repo</a>
</footer>

<script>
// Floating flowers/stars
for(let i=0;i<15;i++){let f=document.createElement("div");f.className="floating-flower";f.style.left=Math.random()*100+"vw";f.style.width=15+Math.random()*15+"px";f.style.height=15+Math.random()*15+"px";f.style.animationDuration=8+Math.random()*8+"s";document.body.appendChild(f);}
for(let i=0;i<30;i++){let s=document.createElement("div");s.className="star";s.style.left=Math.random()*100+"vw";s.style.animationDuration=15+Math.random()*10+"s";document.body.appendChild(s);}

// Sidebar facts
const facts=[
  "NASA satellites help track vegetation growth across the globe in near real-time.",
  "Phenology is the study of periodic plant and animal life cycle events.",
  "NDVI (Normalized Difference Vegetation Index) helps determine plant health using satellite data.",
  "Cherry blossoms in Japan have been tracked by NASA to study climate impacts.",
  "Sunflowers track the sun, a phenomenon called heliotropism.",
  "NASA GLOBE Observer allows citizens worldwide to submit bloom observations.",
  "Tracking blooms helps predict pollinator activity and ecosystem health.",
  "MODIS satellites provide high-resolution NDVI data every 16 days.",
  "Phenology data can be used to study climate change effects on plant life.",
  "BloomWatch combines citizen science and satellite data for actionable insights."
];
const factsText=document.getElementById("factsText");
const newFactBtn=document.getElementById("newFact");
function showRandomFact(){factsText.textContent=facts[Math.floor(Math.random()*facts.length)];}
showRandomFact();
newFactBtn.addEventListener("click",showRandomFact);

// Map setup
const map=L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:"¬© OpenStreetMap"}).addTo(map);
const ndvi=L.tileLayer("https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_NDVI/default/{Time}/{TileMatrixSet}/{z}/{y}/{x}.png",{attribution:"NASA MODIS NDVI"}).addTo(map);
const heatLayer=L.heatLayer([], {radius:25, blur:15, maxZoom:10}).addTo(map);
let allData=[];

// DOM
const speciesFilter=document.getElementById("speciesFilter");
const timeline=document.getElementById("timeline");
const timelineDate=document.getElementById("timeline-date");
const ndviFilter=document.getElementById("ndviFilter");
const totalObs=document.getElementById("totalObs");
const speciesCount=document.getElementById("speciesCount");
const nextBloom=document.getElementById("nextBloom");
const topSpeciesList=document.getElementById("topSpeciesList");
const exportCSV=document.getElementById("exportCSV");
const playTimelineBtn=document.getElementById("playTimeline");
const predictionText=document.getElementById("prediction-text");
let animIndex=0,isPlaying=false,animationInterval;

// Fetch NASA GLOBE phenology data
async function fetchData(){
  document.getElementById("loadingOverlay").style.display="flex";
  try{
    const res=await fetch("https://api.globe.gov/bloom?apikey=G8Gas1lsJXauEbFuavZraSr6ivd0awV9g13zGrxU");
    allData=await res.json();
    if(!allData.length){throw "Empty Data";}
    populateSpecies();
    renderVisuals();
  }catch(e){
    console.log("Error fetching API, using demo data.",e);
    allData=[{species:"Cherry Blossom",date:"2025-03-28",lat:35.68,lng:139.69,ndvi:0.65},
             {species:"Sunflower",date:"2025-06-10",lat:36.77,lng:-119.41,ndvi:0.8},
             {species:"Lavender",date:"2025-07-15",lat:43.77,lng:11.25,ndvi:0.55}];
    populateSpecies();
    renderVisuals();
  }finally{
    document.getElementById("loadingOverlay").style.display="none";
  }
}

function populateSpecies(){
  const speciesSet=new Set(allData.map(d=>d.species));
  speciesSet.forEach(s=>{let opt=document.createElement("option");opt.value=s;opt.textContent=s;speciesFilter.appendChild(opt);});
}

function renderVisuals(){
  let filtered=allData;
  if(speciesFilter.value!=="All") filtered=filtered.filter(d=>d.species===speciesFilter.value);
  if(ndviFilter.checked) filtered=filtered.filter(d=>d.ndvi>0.5);
  renderData(filtered); renderCharts(); updateHeroStats(); updateTopSpecies(); updateHotspot();
}

function renderData(data){
  heatLayer.setLatLngs(data.map(d=>[d.lat,d.lng,d.ndvi]));
}

function renderCharts(){
  const ctx=document.getElementById("barChart").getContext("2d");
  const counts={};
  allData.forEach(d=>{counts[d.species]=(counts[d.species]||0)+1;});
  new Chart(ctx,{type:"bar",data:{labels:Object.keys(counts),datasets:[{label:"Observations",data:Object.values(counts),backgroundColor:"#2ecc71"}]},options:{responsive:true,plugins:{legend:{display:false}}}});

  const timelineCtx=document.getElementById("timelineChart").getContext("2d");
  const dates=[...new Set(allData.map(d=>d.date))].sort((a,b)=>new Date(a)-new Date(b));
  const timelineCounts=dates.map(dt=>allData.filter(d=>d.date===dt).length);
  new Chart(timelineCtx,{type:"line",data:{labels:dates,datasets:[{label:"Blooms Over Time",data:timelineCounts,borderColor:"#ff4757",backgroundColor:"rgba(255,71,87,0.3)",fill:true}]},options:{responsive:true}});
}

function updateHeroStats(){
  totalObs.textContent=allData.length;
  speciesCount.textContent=new Set(allData.map(d=>d.species)).size;
  nextBloom.textContent=predictNextBloom()[0]||"N/A";
}

function updateTopSpecies(){
  const counts={};
  allData.forEach(d=>{counts[d.species]=(counts[d.species]||0)+1;});
  const sorted=Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,5);
  topSpeciesList.innerHTML="";
  sorted.forEach(s=>{let span=document.createElement("span");span.textContent=s[0]+" ";span.className="pred-item";topSpeciesList.appendChild(span);});
}

function predictNextBloom(){
  return allData.map(d=>{let next=new Date(d.date); next.setDate(next.getDate()+7); return `${d.species} around ${next.toISOString().split("T")[0]}`;});
}

function updateHotspot(){
  if(!allData.length){document.getElementById("hotspot").textContent="N/A"; return;}
  const counts={};
  allData.forEach(d=>{const key=d.lat.toFixed(1)+","+d.lng.toFixed(1); counts[key]=(counts[key]||0)+1;});
  const hotspot=Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0];
  document.getElementById("hotspot").textContent=hotspot;
}

// CSV Export
exportCSV.addEventListener("click",()=>{
  let filtered=allData;
  if(speciesFilter.value!=="All") filtered=filtered.filter(d=>d.species===speciesFilter.value);
  if(ndviFilter.checked) filtered=filtered.filter(d=>d.ndvi>0.5);
  const csv="Species,Date,Lat,Lng,NDVI\n"+filtered.map(d=>`${d.species},${d.date},${d.lat},${d.lng},${d.ndvi.toFixed(2)}`).join("\n");
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="bloom_data.csv"; a.click(); URL.revokeObjectURL(url);
});

// Timeline
playTimelineBtn.addEventListener("click",()=>{if(isPlaying){clearInterval(animationInterval);playTimelineBtn.textContent="‚ñ∂Ô∏è Play Timeline";isPlaying=false;return;} const dates=[...new Set(allData.map(d=>d.date))].sort((a,b)=>new Date(a)-new Date(b)); animIndex=0; playTimelineBtn.textContent="‚è∏ Pause"; isPlaying=true; animationInterval=setInterval(()=>{if(animIndex>=dates.length){animIndex=0;} const currentDate=dates[animIndex]; timelineDate.textContent=`Date: ${currentDate}`; renderData(allData.filter(d=>new Date(d.date)<=new Date(currentDate))); renderCharts(); updateTopSpecies(); updateHotspot(); animIndex++;},800);});

speciesFilter.addEventListener("change",renderVisuals);
ndviFilter.addEventListener("change",renderVisuals);
timeline.addEventListener("input",renderVisuals);

fetchData();
</script>
</body>
</html>
