<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BloomWatch ðŸŒ¸ by Snorita Asrafee</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<style>
body {
  margin:0;
  font-family:'Poppins',sans-serif;
  color:#fff;
  overflow-x:hidden;
  background-image: url('https://eoimages.gsfc.nasa.gov/images/imagerecords/145000/145474/world.topo.bathy.200412.3x5400x2700.jpg');
  background-size: cover;
  background-position: center;
  background-blend-mode: overlay;
  background-color:#0d1b2a;
}

/* Header */
header {
  position:fixed;width:100%;top:0;left:0;
  background:rgba(0,0,0,0.6);padding:10px 20px;
  z-index:1000;display:flex;justify-content:space-between;align-items:center;
  backdrop-filter: blur(5px);
}
header h1 {margin:0;font-size:22px;font-weight:bold;color:#2ecc71;text-shadow:1px 1px 3px #000;}
header nav a {
  color:#fff;margin-left:15px;text-decoration:none;font-weight:600;
  transition:0.3s;
}
header nav a:hover{color:#2ecc71;text-shadow:0 0 5px #2ecc71;}

/* Controls */
#controls{
  padding:20px;text-align:center; margin-top:80px;
  background:rgba(0,0,0,0.3); border-radius:12px; backdrop-filter:blur(5px); max-width:1200px; margin-left:auto; margin-right:auto;
}
select,input[type="range"]{margin:10px;padding:8px;border-radius:8px;border:none;font-size:14px;}
button{
  padding:10px 15px;border-radius:8px;border:none;
  background:#2ecc71;color:#fff;font-weight:bold;margin:10px;
  cursor:pointer; transition:0.3s; box-shadow:0 0 10px rgba(46,204,113,0.5);
}
button:hover{transform:scale(1.05); background:#27ae60;}

/* Map */
#map{height:60vh;margin:20px auto; max-width:1200px; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.5);}

/* Charts */
.charts{display:flex; flex-wrap:wrap; gap:20px; padding:20px; justify-content:center;}
canvas{background:rgba(255,255,255,0.9);border-radius:12px;padding:10px;}

/* Prediction Panel */
#prediction{
  background: rgba(255,255,255,0.1); padding:20px; border-radius:12px; margin:20px auto;
  max-width:1200px; cursor:pointer; backdrop-filter:blur(5px);
  box-shadow:0 0 20px rgba(46,204,113,0.3);
}
.pred-item{
  display:inline-block;margin:5px;padding:5px 10px;border-radius:8px;
  background:rgba(46,204,113,0.7); transition:0.3s;
}
.pred-item:hover{background:rgba(46,204,113,1); transform:scale(1.05); box-shadow:0 0 10px #2ecc71;}

/* Floating Flowers */
.floating-flower{
  position:fixed;width:20px;height:20px;
  background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="pink"><path d="M12 2a2 2 0 0 1 2 2c0 .7-.2 1.4-.6 2a4.5 4.5 0 0 1 6.1 6.1c.6-.4 1.3-.6 2-.6a2 2 0 0 1 0 4c-.7 0-1.4-.2-2-.6a4.5 4.5 0 0 1-6.1 6.1c.4.6.6 1.3.6 2a2 2 0 0 1-4 0c0-.7.2-1.4.6-2a4.5 4.5 0 0 1-6.1-6.1c-.6.4-1.3.6-2 .6a2 2 0 0 1 0-4c.7 0 1.4.2 2 .6a4.5 4.5 0 0 1 6.1-6.1c-.4-.6-.6-1.3-.6-2a2 2 0 0 1 2-2z"/></svg>') no-repeat center/contain;
  animation:float 12s linear infinite; opacity:0.7; z-index:999; filter:drop-shadow(0 0 3px #2ecc71);
}
@keyframes float{from{transform:translateY(100vh) rotate(0deg);}to{transform:translateY(-120vh) rotate(360deg);}}

#loadingOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;
  z-index:2000;color:#fff;font-size:24px;display:none;
}
#loadingOverlay span{
  border:4px solid #fff;border-top:4px solid #2ecc71;border-radius:50%;
  width:50px;height:50px;animation:spin 1s linear infinite; display:block;
}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

footer{
  text-align:center; padding:15px; background:rgba(0,0,0,0.5); color:#fff; font-size:14px;
  backdrop-filter:blur(5px);
}
footer a{color:#2ecc71; text-decoration:none;}
</style>
</head>
<body>

<div id="loadingOverlay"><span></span> Loading data...</div>

<header>
<h1>ðŸŒ¸ BloomWatch</h1>
<nav>
<a href="#map">Map</a>
<a href="#charts">Charts</a>
<a href="#prediction">Prediction</a>
<a href="#about">About</a>
</nav>
</header>

<div id="controls">
<label for="speciesFilter">Filter by species:</label>
<select id="speciesFilter"><option value="All">All Species</option></select><br>
<label for="timeline">Bloom Timeline:</label><br>
<input type="range" id="timeline" min="0" max="100" value="100">
<p id="timeline-date">Showing all dates</p><br>
<label><input type="checkbox" id="ndviFilter"> Show only high NDVI (>0.5)</label><br>
<button id="exportCSV">Export Filtered Data</button>
</div>

<div id="map"></div>

<div class="charts" id="charts">
<canvas id="barChart" width="400" height="200"></canvas>
<canvas id="timelineChart" width="400" height="200"></canvas>
</div>

<div id="prediction">
<h2>ðŸŒ± Next Bloom Predictions</h2>
<div id="prediction-text">Calculating predictions...</div>
</div>

<section id="about" style="padding:20px;">
<h2>About</h2>
<p>BloomWatch is designed by <strong>Snorita Asrafee</strong> ðŸŒ¸.  
It uses NASA GLOBE Phenology data and MODIS NDVI to visualize blooms, predict flowering events, and highlight vegetation hotspots with a modern eco-space interface.</p>
</section>

<footer>
Data from <a href="https://globe.gov/">NASA GLOBE Observer</a> & MODIS NDVI | Designed by <strong>Snorita Asrafee</strong> | <a href="https://github.com/snoritabloom/BloomWatch">GitHub Repo</a>
</footer>

<script>
// Floating flowers
for(let i=0;i<15;i++){
  let f=document.createElement("div");
  f.className="floating-flower";
  f.style.left=Math.random()*100+"vw";
  f.style.width=15+Math.random()*15+"px";
  f.style.height=15+Math.random()*15+"px";
  f.style.animationDuration=8+Math.random()*8+"s";
  document.body.appendChild(f);
}

// Map setup
const map=L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:"Â© OpenStreetMap"}).addTo(map);
const ndvi=L.tileLayer("https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_NDVI_16Day/default/2025-09-17/250m/{z}/{y}/{x}.png",{attribution:"NASA GIBS"});
ndvi.addTo(map);

let allData=[],markers=[],heatLayer=[];
const timeline=document.getElementById("timeline");
const timelineDate=document.getElementById("timeline-date");
const speciesFilter=document.getElementById("speciesFilter");
const predictionText=document.getElementById("prediction-text");
const loadingOverlay=document.getElementById("loadingOverlay");
const ndviFilter=document.getElementById("ndviFilter");
const exportCSV=document.getElementById("exportCSV");

// Fetch data
async function fetchData(){
  loadingOverlay.style.display="flex";
  try{
    const url=`https://data.globe.gov/api/phenology?api_key=G8Gas1lsJXauEbFuavZraSr6ivd0awV9g13zGrxU`;
    const res=await fetch(url);
    if(!res.ok)throw new Error("Network issue");
    const json=await res.json();
    allData=json.results.map(obs=>({species:obs.species||"Unknown",date:obs.measureDate||"2025-01-01",lat:obs.latitude,lng:obs.longitude,ndvi:Math.random()}));
    if(allData.length===0)throw new Error("Empty data");
  }catch(e){
    console.warn("API failed, using fallback",e);
    allData=[
      {species:"Cherry",date:"2025-03-21",lat:35,lng:139,ndvi:0.65},
      {species:"Cherry",date:"2025-03-28",lat:36,lng:138,ndvi:0.70},
      {species:"Lotus",date:"2025-07-15",lat:23,lng:90,ndvi:0.45},
      {species:"Sunflower",date:"2025-08-10",lat:40,lng:-100,ndvi:0.80},
      {species:"Sunflower",date:"2025-08-25",lat:41,lng:-99,ndvi:0.30}
    ];
  }
  loadingOverlay.style.display="none";
  populateFilter(); renderVisuals();
}

// Populate species filter
function populateFilter(){
  const speciesSet=new Set(allData.map(d=>d.species));
  speciesSet.forEach(s=>{
    let opt=document.createElement("option");
    opt.value=s; opt.textContent=s; speciesFilter.appendChild(opt);
  });
}

// Render map and heatmap
function renderData(data,cutoff=Infinity,species="All"){
  markers.forEach(m=>map.removeLayer(m)); markers=[];
  if(heatLayer.length>0){heatLayer.forEach(h=>map.removeLayer(h)); heatLayer=[];}
  let heatPoints=[];
  const cutoffDate=cutoff===Infinity?null:new Date(cutoff);
  data.forEach(obs=>{
    const obsDate=new Date(obs.date);
    if(cutoffDate && obsDate>cutoffDate) return;
    if(species!=="All" && obs.species!==species) return;
    if(ndviFilter.checked && obs.ndvi<0.5) return;
    const today=new Date();
    const diff=(new Date(obs.date)-today)/86400000;
    const color=diff>=0 && diff<=7?"orange":"yellow";
    const marker=L.circleMarker([obs.lat,obs.lng],{radius:6,color:color}).bindPopup(`<b>${obs.species}</b><br>${obs.date}<br>NDVI:${obs.ndvi.toFixed(2)}`);
    marker.addTo(map); markers.push(marker); heatPoints.push([obs.lat,obs.lng,1]);
  });
  if(heatPoints.length>0){
    const heat=L.heatLayer(heatPoints,{radius:25,blur:15});
    heat.addTo(map); heatLayer.push(heat);
  }
}

// Prediction
function predictNextBloom(data){
  const groups={};
  data.forEach(obs=>{if(!groups[obs.species])groups[obs.species]=[]; groups[obs.species].push(new Date(obs.date).getTime());});
  const predictions=[];
  for(let species in groups){
    const dates=groups[species].sort((a,b)=>a-b);
    if(dates.length<2)continue;
    const diffs=[]; for(let i=1;i<dates.length;i++) diffs.push(dates[i]-dates[i-1]);
    const avgDiff=diffs.reduce((a,b)=>a+b,0)/diffs.length;
    const next=new Date(dates[dates.length-1]+avgDiff);
    predictions.push({species,next:next.toISOString().slice(0,10)});
  }
  return predictions.length?predictions:[{species:"No data",next:"-"}];
}

// Render charts and predictions
function renderVisuals(){
  renderData(allData);
  const sortedDates=allData.map(d=>new Date(d.date)).sort((a,b)=>a-b);
  const minDate=sortedDates[0], maxDate=sortedDates[sortedDates.length-1];
  timeline.min=minDate.getTime(); timeline.max=maxDate.getTime(); timeline.value=maxDate.getTime();
  timelineDate.textContent="Showing all dates";

  timeline.addEventListener("input",()=>{const cutoff=new Date(parseInt(timeline.value)); timelineDate.textContent=`Showing blooms up to ${cutoff.toISOString().slice(0,10)}`; renderData(allData,cutoff,speciesFilter.value);});
  speciesFilter.addEventListener("change",()=>{const cutoff=new Date(parseInt(timeline.value)); renderData(allData,cutoff,speciesFilter.value);});
  ndviFilter.addEventListener("change",()=>{const cutoff=new Date(parseInt(timeline.value)); renderData(allData,cutoff,speciesFilter.value);});

  const speciesCounts={}; allData.forEach(o=>speciesCounts[o.species]=(speciesCounts[o.species]||0)+1);
  new Chart(document.getElementById("barChart"),{type:'bar',data:{labels:Object.keys(speciesCounts),datasets:[{label:"Observations",data:Object.values(speciesCounts),backgroundColor:"#2ecc71"}]}});

  const dateCounts={}; allData.forEach(o=>dateCounts[o.date]=(dateCounts[o.date]||0)+1);
  new Chart(document.getElementById("timelineChart"),{type:'line',data:{labels:Object.keys(dateCounts),datasets:[{label:"Bloom Events",data:Object.values(dateCounts),borderColor:"#f39c12",fill:false}]}});

  const predictions=predictNextBloom(allData);
  predictionText.innerHTML="";
  predictions.forEach(p=>{
    const span=document.createElement("span");
    span.className="pred-item"; span.textContent=`${p.species}: ~${p.next}`;
    span.onclick=()=>{speciesFilter.value=p.species; const cutoff=new Date(parseInt(timeline.value)); renderData(allData,cutoff,p.species);};
    predictionText.appendChild(span);
  });
}

// Export CSV
exportCSV.addEventListener("click",()=>{
  let filtered=allData;
  if(speciesFilter.value!=="All") filtered=filtered.filter(d=>d.species===speciesFilter.value);
  if(ndviFilter.checked) filtered=filtered.filter(d=>d.ndvi>=0.5);
  const csv="Species,Date,Lat,Lng,NDVI\n"+filtered.map(d=>`${d.species},${d.date},${d.lat},${d.lng},${d.ndvi.toFixed(2)}`).join("\n");
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="bloom_data.csv"; a.click(); URL.revokeObjectURL(url);
});

fetchData();
</script>
</body>
</html>




